<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - ReserveEase</title>
    <meta name="description" content="Admin dashboard for managing hotels, rooms, and reservations">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        /* Same CSS Variables as main site */
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #f8fafc;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --pending-color: #f59e0b;

            --white: #ffffff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;

            --background-color: var(--white);
            --surface-color: var(--gray-50);
            --text-primary: var(--gray-900);
            --text-secondary: var(--gray-600);
            --border-color: var(--gray-200);

            --dark-background: var(--gray-900);
            --dark-surface: var(--gray-800);
            --dark-text-primary: var(--white);
            --dark-text-secondary: var(--gray-300);
            --dark-border: var(--gray-700);

            --font-family: 'Inter', sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            --font-size-5xl: 3rem;

            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;

            --radius: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);

            --z-dropdown: 1000;
            --z-modal: 2000;
            --z-notification: 3000;
        }

        [data-theme="dark"] {
            --background-color: var(--dark-background);
            --surface-color: var(--dark-surface);
            --text-primary: var(--dark-text-primary);
            --text-secondary: var(--dark-text-secondary);
            --border-color: var(--dark-border);
        }

        /* Base Styles */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            height: 100%;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--background-color);
            transition: background-color var(--transition-normal), color var(--transition-normal);
            min-height: 100%;
            overflow-x: hidden;
        }

        /* Dashboard Layout */
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--white);
            border-right: 1px solid var(--border-color);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            overflow-y: auto;
            transition: transform var(--transition-normal);
        }

        [data-theme="dark"] .sidebar {
            background: var(--dark-surface);
        }

        .sidebar-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .sidebar-brand {
            font-size: var(--font-size-xl);
            font-weight: 800;
            color: var(--primary-color);
            text-decoration: none;
        }

        .sidebar-nav {
            padding: var(--space-4) 0;
        }

        .nav-item {
            margin-bottom: var(--space-1);
            padding: 0 var(--space-4);
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            color: var(--text-primary);
            text-decoration: none;
            border-radius: var(--radius);
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--surface-color);
            color: var(--primary-color);
        }

        .nav-link.active {
            background: var(--primary-color);
            color: var(--white);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Top Bar */
        .top-bar {
            background: var(--white);
            border-bottom: 1px solid var(--border-color);
            padding: var(--space-4) var(--space-6);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        [data-theme="dark"] .top-bar {
            background: var(--dark-surface);
        }

        .top-bar-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--text-primary);
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .theme-toggle {
            background: var(--surface-color);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-full);
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .theme-toggle:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            background: var(--surface-color);
        }

        /* Content Area */
        .content {
            flex: 1;
            padding: var(--space-6);
            background: var(--surface-color);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-fast);
        }

        [data-theme="dark"] .stat-card {
            background: var(--dark-surface);
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xl);
            color: var(--white);
        }

        .stat-icon.primary {
            background: var(--primary-color);
        }

        .stat-icon.success {
            background: var(--success-color);
        }

        .stat-icon.warning {
            background: var(--warning-color);
        }

        .stat-icon.danger {
            background: var(--danger-color);
        }

        .stat-info h3 {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--space-1);
        }

        .stat-info p {
            font-size: var(--font-size-3xl);
            font-weight: 800;
            color: var(--text-primary);
        }

        /* Tables */
        .table-container {
            background: var(--white);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        [data-theme="dark"] .table-container {
            background: var(--dark-surface);
        }

        .table-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .table-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--text-primary);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: var(--space-4);
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background: var(--surface-color);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .table tbody tr:hover {
            background: var(--surface-color);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius);
            font-weight: 600;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-sm);
            min-height: 40px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger-color);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning-color);
            color: var(--white);
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-sm {
            padding: var(--space-2) var(--space-3);
            font-size: var(--font-size-xs);
            min-height: 32px;
        }

        /* Status badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge.pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border: 1px solid var(--warning-color);
        }

        .badge.confirmed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .badge.rejected {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }

        .badge.cancelled {
            background: rgba(107, 114, 128, 0.1);
            color: var(--gray-600);
            border: 1px solid var(--gray-400);
        }

        .badge.completed {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info-color);
            border: 1px solid var(--info-color);
        }

        .badge.available {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .badge.fully-booked {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: var(--z-modal);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
            padding: var(--space-4);
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--background-color);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            max-width: 600px;
            width: 100%;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
            transform: scale(0.8) translateY(-50px);
            transition: transform var(--transition-normal);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: var(--space-4);
        }

        .modal-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-size-xl);
            color: var(--text-secondary);
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius);
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            color: var(--danger-color);
            background: var(--surface-color);
        }

        /* Form */
        .form-group {
            margin-bottom: var(--space-4);
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-2);
            font-size: var(--font-size-sm);
        }

        .form-input {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: var(--font-size-base);
            background: var(--background-color);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: var(--space-6);
            right: var(--space-6);
            background: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            box-shadow: var(--shadow-xl);
            z-index: var(--z-notification);
            min-width: 300px;
            max-width: 400px;
            transform: translateX(100%);
            opacity: 0;
            transition: all var(--transition-normal);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .toast-icon {
            color: var(--success-color);
            font-size: var(--font-size-xl);
        }

        .toast-message {
            flex: 1;
            color: var(--text-primary);
            font-weight: 500;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: var(--space-1);
            border-radius: var(--radius);
            transition: all var(--transition-fast);
        }

        .toast-close:hover {
            color: var(--text-primary);
            background: var(--surface-color);
        }

        /* Grid layouts */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-4);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--space-2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .top-bar {
                padding: var(--space-3) var(--space-4);
            }

            .content {
                padding: var(--space-4);
            }
        }

        /* Utility classes */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mb-4 {
            margin-bottom: var(--space-4);
        }

        .mb-6 {
            margin-bottom: var(--space-6);
        }

        .mr-2 {
            margin-right: var(--space-2);
        }

        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .justify-between {
            justify-content: space-between;
        }

        .items-center {
            align-items: center;
        }

        .gap-2 {
            gap: var(--space-2);
        }

        .gap-4 {
            gap: var(--space-4);
        }

        .image-status {
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius);
            font-size: var(--font-size-sm);
            font-weight: 600;
            display: inline-block;
            margin-bottom: 0.75rem;
        }

        .image-status.has-image {
            background: rgba(16, 185, 129, 0.1);
            /* green bg */
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .image-status.no-image {
            background: rgba(239, 68, 68, 0.1);
            /* red bg */
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }
    </style>
</head>

<body data-theme="light">
    <!-- Admin Dashboard Layout -->
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-hotel" style="color: var(--primary-color); font-size: var(--font-size-2xl);"></i>
                <span class="sidebar-brand">ReserveEase</span>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-item">
                    <a class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" data-section="bookings">
                        <i class="fas fa-calendar-check"></i>
                        Reservations
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" data-section="hotels">
                        <i class="fas fa-building"></i>
                        Hotels Management
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" data-section="rooms">
                        <i class="fas fa-bed"></i>
                        Room Management
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" data-section="users">
                        <i class="fas fa-users"></i>
                        Users Management
                    </a>
                </div>
                <div class="nav-item"
                    style="margin-top: var(--space-8); border-top: 1px solid var(--border-color); padding-top: var(--space-4);">
                    <a type="button" class="nav-link" id="homeLink" href="../test3.html">
                        return to site
                    </a>


            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">


            <!-- Top Bar -->
            <header class="top-bar">
                <div class="top-bar-title" id="pageTitle">Dashboard</div>
                <div class="top-bar-actions">
                    <button class="theme-toggle" id="themeToggle" aria-label="Toggle Theme">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <div class="admin-profile">
                        <i class="fas fa-user-shield"></i>
                        <span>Administrator</span>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content">

                <!-- Dashboard Section -->
                <section class="content-section active" id="dashboard-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon primary">
                                    <i class="fas fa-building"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>Total Hotels</h3>
                                    <p id="totalHotels">0</p>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon success">
                                    <i class="fas fa-bed"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>Total Rooms</h3>
                                    <p id="totalRooms">0</p>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon warning">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>Pending Reservations</h3>
                                    <p id="pendingBookings">0</p>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon danger">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>Total Users</h3>
                                    <p id="totalUsers">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Bookings -->
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Pending Reservations</h2>
                            <button class="btn btn-primary" style="margin-left: 10px;"
                                onclick="showSection('bookings')">
                                <i class="fas fa-eye"></i>
                                View All
                            </button>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Booking ID</th>
                                    <th>Guest</th>
                                    <th>Hotel</th>
                                    <th>Dates</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingBookingsTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Bookings Section -->
                <section class="content-section" id="bookings-section">
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">All Reservations</h2>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Guest Info</th>
                                    <th>Hotel & Room</th>
                                    <th>Dates</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="allBookingsTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Hotels Section -->
                <section class="content-section" id="hotels-section">
                    <div class="flex justify-between items-center mb-6">
                        <button class="btn btn-primary" id="addHotelBtn">
                            <i class="fas fa-plus"></i>
                            Add New Hotel
                        </button>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Hotels List</h2>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Location</th>
                                    <th>Price Range</th>
                                    <th>Rating</th>
                                    <th>Reviews</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="hotelsTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Rooms Section -->
                <section class="content-section" id="rooms-section">
                    <div class="flex justify-between items-center mb-6">
                        <button class="btn btn-primary" id="addRoomBtn">
                            <i class="fas fa-plus"></i>
                            Add New Room
                        </button>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Rooms List</h2>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Hotel</th>
                                    <th>Room Type</th>
                                    <th>Price</th>
                                    <th>Capacity</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="roomsTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Users Section -->
                <section class="content-section" id="users-section">
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Users List</h2>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Role</th>
                                    <th>Registered</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Hotel Modal -->
    <div class="modal" id="hotelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="hotelModalTitle">Add New Hotel</h2>
                <button class="modal-close" id="hotelModalClose">&times;</button>
            </div>

            <form id="hotelForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="hotelName" class="form-label">Name</label>
                    <input type="text" id="hotelName" class="form-input" required />
                </div>

                <div class="form-group">
                    <label for="hotelCity" class="form-label">City</label>
                    <input type="text" id="hotelCity" class="form-input" required />
                </div>

                <div class="form-group">
                    <label for="hotelAddress" class="form-label">Address</label>
                    <input type="text" id="hotelAddress" class="form-input" required />
                </div>

                <div class="form-group">
                    <label for="hotelDescription" class="form-label">Description</label>
                    <textarea id="hotelDescription" class="form-input"></textarea>
                </div>

                <div class="form-group">
                    <label for="hotelImage" class="form-label">Image</label>

                    <!-- Styled status line -->
                    <div id="hotelImageStatus" class="image-status mb-4"></div>

                    <!-- File input -->
                    <input type="file" id="hotelImage" class="form-input" accept="image/*" />
                </div>

                <!-- Actions -->
                <div class="actions-grid">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Hotel
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideModal('hotelModal')">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Room Modal -->
    <div class="modal" id="roomModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="roomModalTitle">Add New Room</h2>
                <button class="modal-close" id="roomModalClose">&times;</button>
            </div>
            <form id="roomForm">
                <!-- Hotel (full width) -->
                <div class="form-group">
                    <label for="roomHotel" class="form-label">Hotel</label>
                    <select id="roomHotel" class="form-input" required style="width: 100%">
                        <option value="">Select Hotel</option>
                        <!-- populated dynamically -->
                    </select>
                </div>

                <!-- Grid for type + price -->
                <div class="form-grid">
                    <!-- Room Type -->
                    <div class="form-group">
                        <label for="roomType" class="form-label">Room Type</label>
                        <select id="roomType" class="form-input" required>
                            <option value="1">Deluxe</option>
                            <option value="2">Suite</option>
                            <option value="3">Standard</option>
                            <option value="4">Family</option>
                            <option value="5">Single</option>
                            <option value="6">Double</option>
                        </select>
                    </div>

                    <!-- Price -->
                    <div class="form-group">
                        <label for="roomPrice" class="form-label">Price per Night</label>
                        <input type="number" id="roomPrice" class="form-input" placeholder="250" required />
                    </div>
                </div>

                <!-- Description -->
                <div class="form-group">
                    <label for="roomDescription" class="form-label">Description</label>
                    <textarea id="roomDescription" class="form-input"
                        placeholder="Room details, features..."></textarea>
                </div>

                <!-- Actions -->
                <div class="actions-grid">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Room
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideModal('roomModal')">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-content">
            <div class="toast-icon" id="toastIcon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="toast-message" id="toastMessage">Operation completed successfully</div>
            <button class="toast-close" id="toastClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- Token Management for Admin Dashboard ---

        function getAccessToken() {
            return localStorage.getItem("access_token");
        }

        function getRefreshToken() {
            return localStorage.getItem("refresh_token");
        }

        async function refreshAccessToken() {
            const refreshToken = getRefreshToken();
            if (!refreshToken) {
                console.warn("⚠️ No refresh token found, need login.");
                return null;
            }

            try {
                const response = await fetch("http://localhost:5134/api/Auth/refresh-token", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({refreshToken})
                });

                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem("access_token", data.result.accessToken);
                    localStorage.setItem("refresh_token", data.result.refreshToken);
                    return data.result.accessToken;
                } else {
                    console.error("❌ Failed to refresh access token in Admin Dashboard");
                    return null;
                }
            } catch (err) {
                console.error("⚠️ Refresh error:", err.message);
                return null;
            }
        }

        function startRefreshScheduler() {
            setInterval(refreshAccessToken, 10 * 60 * 1000); // every 10 mins
        }

        // --- On page load, auto-refresh token if available ---
        document.addEventListener("DOMContentLoaded", async () => {
            if (getRefreshToken()) {
                await refreshAccessToken();   // refresh once immediately
                startRefreshScheduler();      // schedule automatic refresh
            } else {
                console.warn("⚠️ No tokens in localStorage. Please login first.");
            }
        });

        // Admin Dashboard Application
        const AdminApp = {
            data: {
                hotels: [],
                rooms: {},
                bookings: [],
                admins: [],
                usercount: 0
            },
            currentEditId: null,
            currentEditType: null
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function () {
            initializeAdminApp();
        });

        function initializeAdminApp() {
            initTheme();
            setupEventListeners();
            loadData();
            updateDashboardStats();
            loadAllTables();
            populateHotelSelects();
        }

        // Theme Management
        function initTheme() {
            const savedTheme = localStorage.getItem('admin-theme') || 'light';
            setTheme(savedTheme);

            document.getElementById('themeToggle')?.addEventListener('click', toggleTheme);
        }

        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('admin-theme', theme);

            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            }
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        // Event Listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link[data-section]').forEach(link => {
                link.addEventListener('click', (e) => {
                    const section = e.target.closest('.nav-link').getAttribute('data-section');
                    showSection(section);
                });
            });

            // Back to site
            // document.getElementById('backToSite')?.addEventListener('click', () => {
            //     if (confirm('Are you sure you want to go back to the main site?')) {
            //         window.location.href = 'test3.html';
            //     }
            // });

            // Modal events
            document.getElementById('addHotelBtn')?.addEventListener('click', () => openHotelModal());
            document.getElementById('addRoomBtn')?.addEventListener('click', () => openRoomModal());

            // Form submissions
            document.getElementById('hotelForm')?.addEventListener('submit', handleHotelSubmit);
            document.getElementById('roomForm')?.addEventListener('submit', handleRoomSubmit);

            // Modal close buttons
            document.getElementById('hotelModalClose')?.addEventListener('click', () => hideModal('hotelModal'));
            document.getElementById('roomModalClose')?.addEventListener('click', () => hideModal('roomModal'));

            // Toast close
            document.getElementById('toastClose')?.addEventListener('click', () => hideToast());

            // Close modals on outside click
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    hideModal(e.target.id);
                }
            });
        }

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionName + '-section')?.classList.add('active');

            // Add active class to nav link
            document.querySelector(`[data-section="${sectionName}"]`)?.classList.add('active');

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                bookings: 'Reservations Management',
                hotels: 'Hotels Management',
                rooms: 'Room Management',
                users: 'Users Management',
                inventory: 'Inventory Management'
            };

            document.getElementById('pageTitle').textContent = titles[sectionName] || 'Dashboard';
        }

        // Data Management
        async function loadData() {
            try {
                let token = getAccessToken();
                if (!token) {
                    token = await refreshAccessToken();
                }

                const [hotelsRes, roomsRes, bookingsRes, adminsRes, userCountRes] = await Promise.all([
                    fetch("http://localhost:5134/api/Hotels"),
                    fetch("http://localhost:5134/api/Rooms"),
                    fetch("http://localhost:5134/api/admin/bookings", {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer " + token
                        }
                    }),
                    fetch("http://localhost:5134/api/User/alladmins", {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer " + token
                        }
                    }),
                    fetch("http://localhost:5134/api/User/usercount", {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer " + token
                        }
                    })
                ]);

                AdminApp.data.hotels = await hotelsRes.json();
                AdminApp.data.rooms = await roomsRes.json();
                AdminApp.data.bookings = await bookingsRes.json();
                AdminApp.data.admins = await adminsRes.json();
                const {count} = await userCountRes.json();
                AdminApp.data.usercount = count;

                // Once loaded, update the UI
                updateDashboardStats();
                loadAllTables();
                populateHotelSelects();
            } catch (err) {
                console.error("❌ Error loading data:", err);
                showToast("Failed to load data from server", "error");
            }
        }

        // Dashboard Stats
        function updateDashboardStats() {
            // total hotels → already fine (API gives array)
            const totalHotels = Array.isArray(AdminApp.data.hotels)
                ? AdminApp.data.hotels.length
                : 0;

            // total rooms → API returns array, so just count it
            const totalRooms = Array.isArray(AdminApp.data.rooms)
                ? AdminApp.data.rooms.length
                : 0;

            // pending bookings → check status enum (1 = Pending)
            const pendingBookings = Array.isArray(AdminApp.data.bookings)
                ? AdminApp.data.bookings.filter(b => b.status === 1).length
                : 0;

            const totalUsers = AdminApp.data.usercount ?? 0;

            document.getElementById('totalHotels').textContent = totalHotels;
            document.getElementById('totalRooms').textContent = totalRooms;
            document.getElementById('pendingBookings').textContent = pendingBookings;
            document.getElementById('totalUsers').textContent = totalUsers;
        }

        // Table Loading Functions
        function loadAllTables() {
            loadPendingBookingsTable();
            loadAllBookingsTable();
            loadHotelsTable();
            loadRoomsTable();
            loadUsersTable();
        }

        const statusMap = {
            1: "pending",
            2: "confirmed",
            3: "rejected",
            4: "cancelled",
            5: "completed"
        };

        function loadPendingBookingsTable() {
            const tbody = document.getElementById("pendingBookingsTable");
            if (!tbody) return;

            // Grab only "pending" bookings (status = 1)
            const pendingBookings = (AdminApp.data.bookings || []).filter(
                b => b.status === 1 // BookingStatus.Pending
            );

            if (pendingBookings.length === 0) {
                tbody.innerHTML =
                    '<tr><td colspan="7" class="text-center">No pending reservations</td></tr>';
                return;
            }

            tbody.innerHTML = pendingBookings
                .slice(0, 5) // show top 5
                .map(booking => {
                    const checkinDate = booking.checkIn
                        ? new Date(booking.checkIn)
                        : null;
                    const checkoutDate = booking.checkOut
                        ? new Date(booking.checkOut)
                        : null;

                    return `
            <tr>
                <td>${booking.id}</td>

                <!-- ✅ Guest info -->
                <td>
                  <strong>${booking.user?.username || "Unknown"}</strong><br>
                  <small>${booking.user?.email || "No email"}</small><br>
                  <small>${booking.user?.phone || ""}</small>
                </td>

                <!-- ✅ Hotel -->
                <td>
                  <strong>${booking.hotel?.name || "Unknown"}</strong><br>
                </td>

                <td>
                  ${checkinDate ? checkinDate.toLocaleDateString("en-GB") : "-"}
                  -
                  ${checkoutDate ? checkoutDate.toLocaleDateString("en-GB") : "-"}
                </td>

                <!-- Status badge -->
                <td><span class="badge pending">Pending</span></td>

                <!-- Actions -->
                <td>
                  <button class="btn btn-success btn-sm mr-2"
                          onclick="updateBookingStatus('${booking.id}', 2)">
                      <i class="fas fa-check"></i>
                  </button>
                  <button class="btn btn-danger btn-sm"
                          onclick="updateBookingStatus('${booking.id}', 3)">
                      <i class="fas fa-times"></i>
                  </button>
                </td>
            </tr>
            `;
                })
                .join("");
        }

        function loadAllBookingsTable() {
            const tbody = document.getElementById("allBookingsTable");
            if (!tbody) return;

            const bookingsList = AdminApp.data.bookings || [];
            if (bookingsList.length === 0) {
                tbody.innerHTML =
                    '<tr><td colspan="8" class="text-center">No reservations found</td></tr>';
                return;
            }

            tbody.innerHTML = bookingsList
                .map(booking => {
                    const checkinDate = booking.checkIn
                        ? new Date(booking.checkIn)
                        : null;
                    const checkoutDate = booking.checkOut
                        ? new Date(booking.checkOut)
                        : null;

                    const nights =
                        booking.nights ??
                        (checkinDate && checkoutDate
                            ? Math.ceil(
                                (checkoutDate - checkinDate) /
                                (1000 * 60 * 60 * 24)
                            )
                            : 0);

                    const total =
                        booking.totalPrice ??
                        (booking.room?.basePrice * nights) ??
                        0;

                    // status is numeric enum, convert
                    const statusText = statusMap[booking.status] || "unknown";

                    // 🔧 Build actions
                    let actions = "-"; // default = dash
                    if (statusText === "pending") {
                        actions = `
                    <button class="btn btn-success btn-sm mr-2"
                            onclick="updateBookingStatus('${booking.id}', 2)" 
                            title="Confirm">
                        <i class="fas fa-check"></i>
                    </button>
                    <button class="btn btn-danger btn-sm"
                            onclick="updateBookingStatus('${booking.id}', 3)" 
                            title="Reject">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                    }

                    return `
                <tr>
                  <td>${booking.id}</td>

                  <!-- ✅ Guest info -->
                  <td>
                    <strong>${booking.user?.username || "Unknown"}</strong><br>
                    <small>${booking.user?.email || "No email"}</small><br>
                    <small>${booking.user?.phone || ""}</small>
                  </td>

                  <!-- ✅ Hotel & Room -->
                  <td>
                    <strong>${booking.hotel?.name || "Unknown"}</strong><br>
                    <small>${booking.room?.name || "Unknown"}</small>
                  </td>

                  <!-- ✅ Dates -->
                  <td>
                    ${checkinDate ? checkinDate.toLocaleDateString("en-GB") : "-"} <br>
                    <small>${checkoutDate ? "to " + checkoutDate.toLocaleDateString("en-GB") : ""}</small>
                  </td>

                  <td>${total}</td>
                  <td><span class="badge ${statusText}">${statusText}</span></td>
                  <td>${actions}</td>
                </tr>
            `;
                })
                .join("");
        }

        function loadHotelsTable() {
            const tbody = document.getElementById("hotelsTable");
            if (!tbody) return;

            const hotels = AdminApp.data.hotels;
            if (!Array.isArray(hotels) || hotels.length === 0) {
                tbody.innerHTML =
                    '<tr><td colspan="7" class="text-center">No hotels found</td></tr>';
                return;
            }

            tbody.innerHTML = hotels
                .map(hotel => {
                    return `
                    <tr>
                      <td>${hotel.id}</td>
                      <td><strong>${hotel.name}</strong></td>
                      <td>${hotel.city ? hotel.city + ", " + hotel.address : "N/A"}</td>
                      <td>${hotel.rooms && hotel.rooms.length
                            ? `$${Math.min(...hotel.rooms.map(r => r.basePrice))} - $${Math.max(...hotel.rooms.map(r => r.basePrice))}`
                            : "N/A"}
                      </td>
                      <td>${hotel.averageRating || 0}/5</td>
                      <td>${hotel.reviewCount || 0}</td>
                      <td>
                        <button class="btn btn-primary btn-sm mr-2" onclick="editHotel('${hotel.id}')">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteHotel('${hotel.id}')">
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>`;
                })
                .join("");
        }

        function loadRoomsTable() {
            const tbody = document.getElementById("roomsTable");
            if (!tbody) return;

            const roomsArray = AdminApp.data.rooms; // flat array from API

            if (!Array.isArray(roomsArray) || roomsArray.length === 0) {
                tbody.innerHTML =
                    '<tr><td colspan="7" class="text-center">No rooms found</td></tr>';
                return;
            }

            // Enum mapping
            const roomTypeMap = {
                1: "Deluxe",
                2: "Suite",
                3: "Standard",
                4: "Family",
                5: "Single",
                6: "Double"
            };

            tbody.innerHTML = roomsArray
                .map(room => {
                    const hotel = AdminApp.data.hotels.find(h => h.id == room.hotelId);
                    const roomType = roomTypeMap[room.name] || "Unknown";

                    return `
                    <tr>
                      <td>${hotel?.name || "Unknown"}</td>
                      <td><strong>${roomType} Room</strong></td>
                      <td>$${room.basePrice}</td>
                      <td>${room.isAvailable ? room.capacity : 0}</td>
                      <td>
                        <span class="badge ${room.isAvailable ? "available" : "fully-booked"}">
                          ${room.isAvailable ? "Available" : "Fully Booked"}
                        </span>
                      </td>
                      <td>
                        <button class="btn btn-primary btn-sm mr-2" 
                            onclick="editRoom('${room.hotelId}', '${room.id}')">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" 
                            onclick="deleteRoom('${room.hotelId}', '${room.id}')">
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  `;
                })
                .join("");
        }
        function loadUsersTable() {
            const tbody = document.getElementById('usersTable');
            if (!tbody) return;

            if (AdminApp.data.admins.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">No users found</td></tr>';
                return;
            }

            tbody.innerHTML = AdminApp.data.admins.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td><strong>${user.username}</strong></td>
                    <td>${user.email}</td>
                    <td>${user.phone || 'N/A'}</td>
                    <td>User</td>
                    <td>${new Date(user.createdAt || Date.now()).toLocaleDateString('en-GB')}</td>
                </tr>
            `).join('');
        }

        // Booking Management
        async function updateBookingStatus(bookingId, newStatus) {
            const statusActionMap = {
                2: "confirm",
                3: "reject",
                5: "complete"
            };
            try {
                const action = statusActionMap[newStatus];
                if (!action) {
                    console.error("❌ Unsupported status:", newStatus);
                    return;
                }

                const token = getAccessToken();
                const url = `http://localhost:5134/api/admin/bookings/${bookingId}/${action}`;

                const response = await fetch(url, {
                    method: "PATCH",
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                });

                if (!response.ok) {
                    throw new Error("Failed to update booking");
                }

                // ✅ Update local data for instant UI feedback
                const booking = AdminApp.data.bookings.find(b => b.id === bookingId);
                if (booking) {
                    booking.status = newStatus;
                }

                showToast(`Booking ${action}ed successfully`, "success");
                updateDashboardStats();
                loadAllTables();

            } catch (err) {
                console.error("❌ Error updating booking:", err);
                showToast("Failed to update booking", "error");
            }
        }

        // Hotel Management
        function openHotelModal(hotelId = null) {
            const modal = document.getElementById('hotelModal');
            const title = document.getElementById('hotelModalTitle');
            const form = document.getElementById('hotelForm');

            if (hotelId) {
                // Edit mode
                const hotel = AdminApp.data.hotels.find(h => h.id === hotelId);
                if (!hotel) return;

                title.textContent = 'Edit Hotel';
                AdminApp.currentEditId = hotelId;
                AdminApp.currentEditType = 'hotel';

                // Populate form
                document.getElementById('hotelName').value = hotel.name;
                document.getElementById('hotelLocation').value = hotel.location;
                document.getElementById('hotelPrice').value = hotel.price;
                document.getElementById('hotelRating').value = hotel.rating;
                document.getElementById('hotelReviews').value = hotel.reviews;
                document.getElementById('hotelImage').value = hotel.image;
                document.getElementById('hotelFeatures').value = hotel.features.join(', ');
            } else {
                // Add mode
                title.textContent = 'Add New Hotel';
                AdminApp.currentEditId = null;
                AdminApp.currentEditType = null;
                form.reset();
            }

            showModal('hotelModal');
        }

        function editHotel(hotelId) {
            const hotel = AdminApp.data.hotels.find(h => h.id === hotelId);
            if (!hotel) return;

            document.getElementById("hotelModalTitle").textContent = "Edit Hotel";
            AdminApp.currentEditId = hotelId;
            AdminApp.currentEditType = "hotel";

            // Prefill fields
            document.getElementById("hotelName").value = hotel.name || "";
            document.getElementById("hotelCity").value = hotel.city || "";
            document.getElementById("hotelAddress").value = hotel.address || "";
            document.getElementById("hotelDescription").value = hotel.description || "";

            // ✅ Update status badge
            const statusEl = document.getElementById("hotelImageStatus");
            if (hotel.thumbnailUrl) {
                statusEl.textContent =
                    "✅ Current image is set. Choose a new one if you want to replace it.";
                statusEl.className = "image-status has-image";
            } else {
                statusEl.textContent = "⚠️ No image currently set for this hotel.";
                statusEl.className = "image-status no-image";
            }

            // Reset file input
            document.getElementById("hotelImage").value = "";

            showModal("hotelModal");
        }

        async function deleteHotel(hotelId) {
            if (!confirm('Are you sure you want to delete this hotel? This will also delete all its rooms and reservations.')) {
                return;
            }

            try {
                const token = getAccessToken();

                // 1️⃣ Call backend API
                const response = await fetch(`http://localhost:5134/api/Hotels/admin/${hotelId}`, {
                    method: "DELETE",
                    headers: {"Authorization": "Bearer " + token}
                });

                if (!response.ok) {
                    throw new Error(`Failed to delete hotel (status: ${response.status})`);
                }

                // 2️⃣ Remove hotel + rooms locally
                AdminApp.data.hotels = AdminApp.data.hotels.filter(h => h.id !== hotelId);

                if (Array.isArray(AdminApp.data.rooms)) {
                    AdminApp.data.rooms = AdminApp.data.rooms.filter(r => r.hotelId !== hotelId);
                } else {
                    delete AdminApp.data.rooms[hotelId];
                }

                // 3️⃣ ❌ Remove ALL bookings linked to this hotel
                AdminApp.data.bookings = AdminApp.data.bookings.filter(b => b.hotelId !== hotelId);

                // 4️⃣ Refresh UI
                updateDashboardStats();
                loadAllTables();
                populateHotelSelects();
                showToast("Hotel and related reservations deleted successfully", "success");

            } catch (err) {
                console.error("❌ Error deleting hotel:", err);
                showToast("Failed to delete hotel", "error");
            }
        }

        async function handleHotelSubmit(e) {
            e.preventDefault();

            const name = document.getElementById("hotelName").value;
            const city = document.getElementById("hotelCity").value;
            const address = document.getElementById("hotelAddress").value;
            const description = document.getElementById("hotelDescription").value;

            const fileInput = document.getElementById("hotelImage");

            const formData = new FormData();
            if (fileInput.files.length > 0) {
                formData.append("Image", fileInput.files[0]);
            }

            try {
                const token = getAccessToken();
                let url = "http://localhost:5134/api/Hotels/admin";
                let method = "POST";

                if (AdminApp.currentEditId && AdminApp.currentEditType === "hotel") {
                    // include fields in query string
                    const params = new URLSearchParams({
                        Name: name,
                        City: city,
                        Address: address,
                        Description: description
                    });
                    url = `http://localhost:5134/api/Hotels/admin/${AdminApp.currentEditId}?${params}`;
                    method = "PUT";
                }

                const res = await fetch(url, {
                    method,
                    headers: {Authorization: "Bearer " + token},
                    body: formData
                });

                if (!res.ok) {
                    const errText = await res.text();
                    throw new Error("Hotel save failed: " + errText);
                }

                await loadData();
                showToast(
                    AdminApp.currentEditId
                        ? "Hotel updated successfully!"
                        : "Hotel added successfully!",
                    "success"
                );
                hideModal("hotelModal");
                document.getElementById("hotelForm").reset();
                AdminApp.currentEditId = null;
                AdminApp.currentEditType = null;
            } catch (err) {
                console.error("❌ Hotel save error:", err);
                showToast("Failed to save hotel", "error");
            }
        }

        // Room Management
        function openRoomModal(hotelId = null, roomId = null) {
            const modal = document.getElementById('roomModal');
            const title = document.getElementById('roomModalTitle');
            const form = document.getElementById('roomForm');

            if (hotelId && roomId) {
                // Edit mode
                const room = AdminApp.data.rooms[hotelId]?.find(r => r.id == roomId);
                if (!room) return;

                title.textContent = 'Edit Room';
                AdminApp.currentEditId = roomId;
                AdminApp.currentEditType = 'room';
                AdminApp.currentEditHotelId = hotelId;

                // Populate form
                document.getElementById('roomHotel').value = hotelId;
                document.getElementById('roomName').value = room.name;
                document.getElementById('roomType').value = room.type;
                document.getElementById('roomPrice').value = room.price;
                document.getElementById('roomAvailable').value = room.availableCount || 0;
                document.getElementById('roomImage').value = room.image;
                document.getElementById("roomDescription").value =
                    room.description ? room.description : "";

            } else {
                // Add mode
                title.textContent = 'Add New Room';
                AdminApp.currentEditId = null;
                AdminApp.currentEditType = null;
                AdminApp.currentEditHotelId = null;
                form.reset();
            }

            showModal('roomModal');
        }

        function editRoom(hotelId, roomId) {
            const room = Array.isArray(AdminApp.data.rooms)
                ? AdminApp.data.rooms.find(r => r.id === roomId)
                : (AdminApp.data.rooms[hotelId] || []).find(r => r.id === roomId);

            if (!room) {
                console.error("❌ No room found with id", roomId);
                return;
            }

            const modal = document.getElementById("roomModal");
            if (!modal) {
                console.error("❌ Room modal not in DOM!");
                return;
            }

            document.getElementById("roomModalTitle").textContent = "Edit Room";
            AdminApp.currentEditId = roomId;
            AdminApp.currentEditType = "room";

            // ✅ safe lookups
            const hotelSel = document.getElementById("roomHotel");
            const typeSel = document.getElementById("roomType");
            const priceInput = document.getElementById("roomPrice");
            const descInput = document.getElementById("roomDescription");

            if (hotelSel) hotelSel.value = hotelId;
            if (typeSel) typeSel.value = room.name;        // enum value
            if (priceInput) priceInput.value = room.basePrice;
            if (descInput) descInput.value = room.description ?? "";

            showModal("roomModal");
        }

        async function deleteRoom(hotelId, roomId) {
            if (!confirm('Are you sure you want to delete this room? This will also delete its reservations.')) {
                return;
            }

            try {
                const token = getAccessToken();

                // 1️⃣ Call backend API
                const response = await fetch(`http://localhost:5134/api/Rooms/admin/${roomId}`, {
                    method: "DELETE",
                    headers: {"Authorization": "Bearer " + token}
                });

                if (!response.ok) {
                    throw new Error(`Failed to delete room (status: ${response.status})`);
                }

                // 2️⃣ Remove room locally
                if (Array.isArray(AdminApp.data.rooms)) {
                    AdminApp.data.rooms = AdminApp.data.rooms.filter(r => r.id !== roomId);
                } else {
                    AdminApp.data.rooms[hotelId] = (AdminApp.data.rooms[hotelId] || []).filter(r => r.id !== roomId);
                }

                // 3️⃣ ❌ Remove ALL bookings linked to this hotel+room combo
                AdminApp.data.bookings = AdminApp.data.bookings.filter(
                    b => !(b.hotelId === hotelId && b.roomId === roomId)
                );

                // 4️⃣ Refresh UI
                updateDashboardStats();
                loadAllTables();
                showToast("Room and related reservations deleted successfully", "success");

            } catch (err) {
                console.error("❌ Error deleting room:", err);
                showToast("Failed to delete room", "error");
            }
        }

        async function handleRoomSubmit(e) {
            e.preventDefault();

            const hotelId = document.getElementById("roomHotel").value;
            const roomType = parseInt(document.getElementById("roomType").value, 10);
            const basePrice = parseFloat(document.getElementById("roomPrice").value);
            const description = document.getElementById("roomDescription").value || null;

            const payload = {
                hotelId,
                name: roomType,
                basePrice,
                description,
                isAvailable: true // Always true when created/edited
            };

            try {
                const token = getAccessToken();
                let url = "http://localhost:5134/api/Rooms/admin";
                let method = "POST";

                if (AdminApp.currentEditId && AdminApp.currentEditType === "room") {
                    url = `http://localhost:5134/api/Rooms/admin/${AdminApp.currentEditId}`;
                    method = "PUT";
                }

                const res = await fetch(url, {
                    method,
                    headers: {
                        Authorization: "Bearer " + token,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    const errText = await res.text();
                    throw new Error("Room save failed: " + errText);
                }

                await loadData();
                showToast(
                    AdminApp.currentEditId
                        ? "Room updated successfully!"
                        : "Room added successfully!",
                    "success"
                );
                hideModal("roomModal");
                document.getElementById("roomForm").reset();
                AdminApp.currentEditId = null;
                AdminApp.currentEditType = null;
            } catch (err) {
                console.error("❌ Room save error:", err);
                showToast("Failed to save room", "error");
            }
        }

        // User Management
        function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user? This will affect their bookings.')) {
                return;
            }

            // Remove user
            AdminApp.data.admins = AdminApp.data.admins.filter(u => u.id != userId);

            // Update affected bookings
            AdminApp.data.bookings.forEach(booking => {
                if (booking.userId == userId && ['pending', 'confirmed'].includes(booking.status)) {
                    booking.status = 'cancelled';
                }
            });

            updateDashboardStats();
            loadAllTables();
            showToast('User deleted successfully', 'success');
        }

        // Inventory Management
        function updateInventory(hotelId, roomId) {
            const newCount = prompt('Enter new available room count:');
            if (newCount === null) return;

            const count = parseInt(newCount);
            if (isNaN(count) || count < 0) {
                showToast('Please enter a valid number', 'error');
                return;
            }

            const room = AdminApp.data.rooms[hotelId]?.find(r => r.id == roomId);
            if (room) {
                room.availableCount = count;
                room.availability = count > 0 ? 'available' : 'fully-booked';

                loadAllTables();
                showToast('Inventory updated successfully', 'success');
            }
        }

        // Utility Functions
        function populateHotelSelects() {
            const selects = document.querySelectorAll('#roomHotel');
            selects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select Hotel</option>';

                AdminApp.data.hotels.forEach(hotel => {
                    const option = document.createElement('option');
                    option.value = hotel.id;
                    option.textContent = hotel.name;
                    if (hotel.id == currentValue) option.selected = true;
                    select.appendChild(option);
                });
            });
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = 'auto';
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');

            if (!toast || !toastMessage || !toastIcon) return;

            toastMessage.textContent = message;

            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };

            toastIcon.innerHTML = `<i class="${icons[type] || icons.success}"></i>`;

            // Change toast icon color based on type
            const colors = {
                success: 'var(--success-color)',
                error: 'var(--danger-color)',
                warning: 'var(--warning-color)',
                info: 'var(--info-color)'
            };
            toastIcon.style.color = colors[type] || colors.success;

            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        function hideToast() {
            document.getElementById('toast')?.classList.remove('show');
        }


        console.log('🔧 Admin Dashboard initialized successfully!');
        console.log('📊 Features: Hotel/Room/User Management, Booking Approvals, Inventory Control');
    </script>

</body>

</html>
